# GraphMind Workflow System

**Version**: 1.0
**Last Updated**: 2025-11-10

## Overview

A 5-command workflow system for building GraphMind in context-sized chunks:

1. `/nextspec` - Analyze project, recommend next component
2. `/spec` - Create user-focused specification
3. `/design` - Create technical design
4. `/tasks` - Generate implementation checklist
5. `/validate` - Verify implementation completeness
6. `/updateprd` - Sync PRD docs with reality

## Command Reference

| Command | Input | Output | Purpose |
|---------|-------|--------|---------|
| `/nextspec` | Project state | `NEXT_SPEC.md` | What to build next (~8-30K tokens) |
| `/spec` | `NEXT_SPEC.md` | `specs/NNN/spec.md` | User-focused requirements |
| `/design` | `spec.md` | `specs/NNN/design.md` | Technical architecture |
| `/tasks` | `spec.md` + `design.md` | `specs/NNN/tasks.md` | Implementation checklist |
| `/validate` | Implemented code | `specs/NNN/validation.md` | Completion check |
| `/updateprd` | `validation.md` | Updated PRD docs | Sync documentation |

## Workflow Cycle

```
┌─────────────────────────────────────────────────┐
│ Complete Development Cycle                      │
└─────────────────────────────────────────────────┘

/nextspec → NEXT_SPEC.md
    ↓
/spec → specs/001-component/spec.md
    ↓
/design → specs/001-component/design.md
    ↓
/tasks → specs/001-component/tasks.md
    ↓
IMPLEMENT (follow tasks.md)
    ↓
/validate → specs/001-component/validation.md
    ↓
/updateprd → Update all PRD docs
    ↓
Loop back to /nextspec
```

## Directory Structure

```
graphmind/
├── .claude/
│   └── commands/          # Slash commands
│       ├── nextspec.md
│       ├── spec.md
│       ├── design.md
│       ├── tasks.md
│       ├── validate.md
│       └── updateprd.md
├── .workflow/
│   ├── scripts/           # Automation scripts
│   │   ├── common.sh
│   │   ├── setup-feature.sh
│   │   ├── check-prereqs.sh
│   │   └── analyze-project.sh
│   ├── templates/         # Document templates
│   │   ├── nextspec-template.md
│   │   ├── spec-template.md
│   │   ├── design-template.md
│   │   ├── tasks-template.md
│   │   └── validation-template.md
│   └── README.md          # This file
├── docs/
│   └── PRD/
│       ├── NEXT_SPEC.md   # Current recommendation
│       ├── README_PRD.md  # Updated by /updateprd
│       ├── REQUIREMENTS-PRD.md  # Updated by /updateprd
│       ├── IMPLEMENTATION_REPORT.md  # Generated by /updateprd
│       ├── archive/       # Archived NEXT_SPEC files
│       └── phases/        # Updated by /updateprd
└── specs/
    ├── 001-component-name/
    │   ├── spec.md
    │   ├── design.md
    │   ├── tasks.md
    │   ├── validation.md
    │   ├── contracts/     # API specifications
    │   └── checklists/    # Quality checklists
    └── 002-next-component/
        └── ...
```

## Known Limitations

### Design Decisions (Intentional)

1. **Single Context Focus**: NEXT_SPEC.md recommends one component at a time (8-30K tokens)
   - **Why**: Designed for solo development in single context window
   - **Workaround**: Create multiple specs manually if needed

2. **Linear Workflow**: Commands expect sequential execution
   - **Why**: Ensures completeness and quality
   - **Workaround**: Skip steps at your own risk (not recommended)

3. **File-Based Detection**: `analyze-project.sh` checks file existence, not functionality
   - **Why**: Can't automatically test if code actually works
   - **Workaround**: `/validate` provides manual verification

### Protected Against

✅ **NEXT_SPEC.md Overwrite**: `/nextspec` checks for existing file before overwriting
✅ **Duplicate Specs**: `/spec` prevents multiple runs on same NEXT_SPEC.md
✅ **Missing Archive Dir**: `/nextspec` creates `docs/PRD/archive/` directory
✅ **Stale Documentation**: `/updateprd` syncs PRD with actual implementation

### Edge Cases to Be Aware Of

1. **Manual File Deletion**: If you delete specs or code, run `/updateprd` to resync
2. **Alternative Project Structure**: Script checks common paths; different structure may not be detected
3. **Parallel Features**: Working on multiple features? Complete one before `/nextspec` for the next
4. **Git Permissions**: Scripts need `chmod +x` - may need to reapply after clone

## Safeguards

### Before Overwriting
- `/nextspec` checks if NEXT_SPEC.md exists and is in use
- `/spec` checks if NEXT_SPEC.md already converted to spec
- Both commands prompt user before proceeding

### During Updates
- `/updateprd` validates spec completion via validation.md status
- Only specs with "✅ Ready" status marked as complete
- Preserves original PRD content, only updates status sections

### Error Prevention
- Scripts use `set -euo pipefail` (fail fast on errors)
- JSON output for reliable parsing
- Absolute paths to avoid confusion

## Troubleshooting

### "NEXT_SPEC.md not found"
**Problem**: Trying to run `/spec` without running `/nextspec` first
**Solution**: Run `/nextspec` to generate NEXT_SPEC.md

### "NEXT_SPEC.md already converted"
**Problem**: Running `/spec` twice on same NEXT_SPEC.md
**Solution**: Continue with existing spec or run `/nextspec` for new recommendation

### "Permission denied" on scripts
**Problem**: Scripts not executable
**Solution**: `chmod +x .workflow/scripts/*.sh`

### "Feature directory already exists"
**Problem**: Trying to create duplicate spec number
**Solution**: Delete old spec or let auto-increment create new number

### Wrong next recommendation
**Problem**: `/nextspec` recommends wrong component
**Solution**: Run `/updateprd` to sync documentation, then `/nextspec` again

## Testing Workflow

You can test the workflow system:

```bash
# Test project analysis
bash .workflow/scripts/analyze-project.sh

# Test feature setup
bash .workflow/scripts/setup-feature.sh --short-name "test-component"

# Test prerequisites check
bash .workflow/scripts/check-prereqs.sh

# Clean up test
rm -rf specs/001-test-component
```

## Customization

### Adding Custom Checks to analyze-project.sh

Edit `.workflow/scripts/analyze-project.sh` to add detection for your components:

```bash
# Add custom check
if [[ -f "src/your/custom/file.js" ]]; then
    HAS_YOUR_COMPONENT=true
    COMPLETED_COMPONENTS+=("Your Component")
fi
```

### Modifying Templates

Templates in `.workflow/templates/` can be customized:
- Add sections to templates
- Change formatting
- Adjust quality guidelines

Commands will use updated templates automatically.

### Changing Project Structure

If you organize differently than `src/workers/`, `src/lib/`, etc.:
1. Update path checks in `analyze-project.sh`
2. Update `/design` command to reference your structure
3. Update `/tasks` command file paths

## Version History

### v1.0 (2025-11-10)
- Initial release
- 6 commands: nextspec, spec, design, tasks, validate, updateprd
- 3 scripts: setup-feature, check-prereqs, analyze-project
- 5 templates: nextspec, spec, design, tasks, validation
- Safeguards against common errors
- Documentation sync with /updateprd

## Support

For issues or questions:
1. Check this README
2. Review command files in `.claude/commands/`
3. Check script comments in `.workflow/scripts/`
4. Review CLAUDE.md for project conventions

## Philosophy

This workflow system is designed to:
- ✅ Break large projects into context-sized chunks
- ✅ Maintain quality through structured validation
- ✅ Keep documentation in sync with reality
- ✅ Prevent common mistakes (duplicates, overwrites)
- ✅ Support iterative development
- ✅ Work with Claude Code's context window limits

**Not designed for**:
- ❌ Parallel feature development (single NEXT_SPEC at a time)
- ❌ Automatic code generation (you still write the code)
- ❌ Testing code functionality (file existence only)
- ❌ Team coordination (single developer focus)

Use it as a guide, not a prison. Skip steps if you know what you're doing, but the happy path is: nextspec → spec → design → tasks → implement → validate → updateprd → repeat.
